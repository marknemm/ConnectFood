<form [formGroup]="formGroup" *ngIf="originalAccount" class="account-form">
  <div class="account-main align-center">
    <div class="page-title block-label">
      <food-web-username *ngIf="isMyAccount" formControlName="username"></food-web-username>
      <ng-container *ngIf="!isMyAccount">
        <div *ngIf="originalAccount.organization">
          {{ originalAccount.organization.organizationName }}
        </div>
      </ng-container>
    </div>
    <food-web-profile-img formControlName="profileImgUrl" [editable]="isMyAccount"></food-web-profile-img>
  </div>

  <div class="account-type">
    <food-web-account-type formControlName="accountType"></food-web-account-type>
  </div>

  <mat-divider></mat-divider> 

  <p *ngIf="isMyAccount && originalAccount.verified === false" class="account-not-verified">
    Account Not Verified:
    <button mat-button type="button" (click)="signupVerificationService.resendVerificationEmail()">Resend Verification Email</button>
  </p>

  <mat-accordion [multi]="true" displayMode="flat" foodWebFragmentAccordian defaultPanelId="primary">
    <mat-expansion-panel id="primary">
      <mat-expansion-panel-header>
        Primary
      </mat-expansion-panel-header>
      <div class="row account-section-content">
        <div class="col-xl-6">
          <mat-card *ngIf="accountType !== 'Volunteer'">
            <food-web-edit-save-button *ngIf="isMyAccount" [editable]="organization" [saveCb]="genSectionSaveCb('organization')"></food-web-edit-save-button>
            <mat-card-title class="block-label">Organization</mat-card-title>
            <mat-card-content>
              <food-web-organization #organization [formGroup]="formGroup.get('organization')" [accountType]="accountType"></food-web-organization>
              <div *ngIf="originalAccount && !accountHelper.isAdmin(originalAccount)" class="see-donations-link">
                <a *ngIf="!isMyAccount" [routerLink]="['/donation/list']" [queryParams]="seeDonationsParams">See Donations</a>
                <a *ngIf="isMyAccount" [routerLink]="['/donation/list/my']">See My Donations</a>
              </div>
            </mat-card-content>
          </mat-card>

          <mat-card *ngIf="accountType === 'Volunteer'">
            <food-web-edit-save-button *ngIf="isMyAccount" [editable]="volunteer" [saveCb]="genSectionSaveCb('volunteer')"></food-web-edit-save-button>
            <mat-card-title class="block-label">Volunteer Name</mat-card-title>
            <mat-card-content>
              <food-web-volunteer #volunteer [formGroup]="formGroup.get('volunteer')"></food-web-volunteer>
              <div *ngIf="isMyAccount && originalAccount && !accountHelper.isAdmin(originalAccount)" class="see-donations-link">
                <a [routerLink]="['/delivery/list/my']">See My Deliveries</a>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
        <div class="col-xl-6">
          <mat-card>
            <food-web-edit-save-button *ngIf="isMyAccount" [editable]="contactInfo" [saveCb]="genSectionSaveCb('contactInfo')"></food-web-edit-save-button>
            <mat-card-title class="block-label">Contact Info</mat-card-title>
            <mat-card-content>
              <food-web-contact-info #contactInfo [formGroup]="formGroup.get('contactInfo')" [contactInfo]="originalAccount?.contactInfo"></food-web-contact-info>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </mat-expansion-panel>

    <mat-expansion-panel id="availability" *ngIf="accountType && accountType !== 'Donor'">
      <mat-expansion-panel-header>
        Availability
      </mat-expansion-panel-header>
      <div class="row account-section-content">
        <div class="col-sm-12">
          <mat-card class="operation-hours-card" [ngClass]="{ 'full-width': operationHours.editing }">
            <food-web-edit-save-button *ngIf="isMyAccount" [editable]="operationHours" [saveCb]="genSectionSaveCb('operationHours')"></food-web-edit-save-button>
            <mat-card-title class="block-label">
              Delivery Availability
            </mat-card-title>
            <mat-card-subtitle *ngIf="operationHours.editing">
              <span *ngIf="accountType === 'Receiver'">Optionally limit the times you will be considered available to receive deliveries.</span>
              <span *ngIf="accountType === 'Volunteer'">Optionally limit the times you will be considered available to perform deliveries.</span>
            </mat-card-subtitle>
            <mat-card-content>
              <food-web-operation-hours-info #operationHours [operationHoursArr]="originalAccount.operationHours" [formGroup]="formGroup.get('operationHours')"></food-web-operation-hours-info>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </mat-expansion-panel>

    <mat-expansion-panel *ngIf="isMyAccount" id="notifications">
      <mat-expansion-panel-header>
        Notifications
      </mat-expansion-panel-header>
      <div class="row account-section-content">
        <div class="col-sm-12">
          <mat-card class="notification-settings-card">
            <food-web-edit-save-button *ngIf="isMyAccount" [editable]="notificationSettings" [saveCb]="genSectionSaveCb('notificationSettings')"></food-web-edit-save-button>
            <mat-card-title class="block-label">
              Notification Settings
            </mat-card-title>
            <mat-card-content>
              <food-web-notifications-settings #notificationSettings
                [accountType]="originalAccount.accountType"
                [notificationSettings]="originalAccount.contactInfo"
                [formGroup]="formGroup.get('notificationSettings')"
              ></food-web-notifications-settings>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </mat-expansion-panel>

    <mat-expansion-panel id="password" *ngIf="isMyAccount">
      <mat-expansion-panel-header>
        Password
      </mat-expansion-panel-header>
      <div class="row account-section-content">
        <div class="col-sm-12">
          <mat-card class="password-card">
            <food-web-edit-save-button [editing]="true" [editable]="password" [noCancelEdit]="true" [saveCb]="savePassword"></food-web-edit-save-button>
            <mat-card-title class="block-label">Change Password</mat-card-title>
            <mat-card-content>
              <food-web-password #password [formGroup]="formGroup.get('password')" [editing]="true"></food-web-password>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
</form>

<div *ngIf="accountNotFound" class="account-not-found disclaimer">
  Account not found
</div>
