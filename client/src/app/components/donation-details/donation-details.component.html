<div *ngIf="originalDonation" class="donation-details-container">
  <form [formGroup]="donationForm" class="donation-details-form">
    <mat-card>
      <mat-card-header>
        <img mat-card-avatar src="/assets/IconImg.png" alt="FoodWeb Icon">
        <mat-card-title>
          <ng-container *ngIf="!editing">Donation Details</ng-container>
          <ng-container *ngIf="editing">Donation Update</ng-container>
        </mat-card-title>
        <mat-card-subtitle>
          <strong class="donation-details-subtitle">{{ originalDonation?.donorAccount.organization.organizationName }}</strong>
          <food-web-donation-status [donationStatus]="originalDonation?.donationStatus" class="donation-status"></food-web-donation-status>
        </mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="donation-primary-label"></div>
        <food-web-donation-form *ngIf="sectionEditService.editing(donationForm)" [formGroup]="donationForm" class="donation-form"></food-web-donation-form>
        <div *ngIf="!sectionEditService.editing(donationForm)" class="readonly-donation row">
          <div class="col-sm-12 donation-description-container">
            <hr>
            <span>{{ originalDonation.description }}</span>
            <hr>
          </div>
          <div class="col-md-4 col-sm-6">
            <div class="inline-label">Submitter Name:</div>
            <div>{{ originalDonation.donorFirstName }} {{ originalDonation.donorLastName }}</div>
          </div>
          <!-- <div class="col-md-4 col-sm-6">
            <div class="inline-label">Donation Type:</div>
            <div>{{ originalDonation.donationType }}</div>
          </div> -->
          <div class="col-md-4 col-sm-6">
            <div class="inline-label">Estimated Meal Count:</div>
            <div>{{ originalDonation.estimatedNumFeed }}</div>
          </div>
          <div *ngIf="myDonation" class="col-md-4 col-sm-6">
            <div class="inline-label">Estimated Value:</div>
            <div>${{ originalDonation.estimatedValue | number:'1.2-2' }}</div>
          </div>
          <div class="col-md-4 col-sm-6">
            <div class="inline-label">Donated:</div>
            <div>{{ originalDonation.created | date:'short' }}</div>
          </div>
          <div *ngIf="myDonation" class="col-md-4 col-sm-6">
            <div class="inline-label">Last Updated:</div>
            <div>{{ originalDonation.lastUpdated | date:'short' }}</div>
          </div>
        </div>
      </mat-card-content>
      <mat-card-actions *ngIf="hasActionButtons" class="align-right">
        <ng-container *ngIf="canEdit && !sectionEditService.editing(donationForm)">
          <button mat-button foodWebConfirmButton color="warn" class="delete-button" (clickConfirm)="deleteDonation()"
           confirmTitle="Confirm Delete" confirmMessage="Are you sure you want to permanently delete the donation?">
            Delete
          </button>
          <food-web-edit-save-button [useButtonText]="true" [editing]="sectionEditService.editing(donationForm)"
            (edit)="sectionEditService.toggleEdit(donationForm, donationForm)" (save)="saveDonation()"></food-web-edit-save-button>
        </ng-container>
        <button mat-raised-button *ngIf="canClaim" type="button" color="primary" (click)="claimDonation()">Claim Donation</button>
        <button mat-button foodWebConfirmButton *ngIf="canUnclaim" type="button" color="warn"
         (clickConfirm)="unclaimDonation()" confirmTitle="Confirm Unclaim" confirmMessage="Are you sure you want to unclaim the donation?">
          Unclaim Donation
        </button>
      </mat-card-actions>
    </mat-card>

    <mat-card *ngIf="sectionEditService.editing(donationForm)">
      <mat-card-title>Pickup Window</mat-card-title>
      <mat-card-content>
        <food-web-date-time-range formControlName="pickupWindow" [initEndDateToday]="true" [required]="true"></food-web-date-time-range>
      </mat-card-content>
    </mat-card>

    <div *ngIf="sectionEditService.editing(donationForm)" class="action-footer align-right">
      <food-web-edit-save-button [useButtonText]="true" [editing]="sectionEditService.editing(donationForm)"
       (edit)="sectionEditService.toggleEdit(donationForm, donationForm)" (save)="saveDonation()"></food-web-edit-save-button>
    </div>
  </form>
  
  <ng-container *ngIf="!sectionEditService.editing(donationForm)">
    <div class="row">
      <div class="pickup-information-container" [ngClass]="{
        'col-lg-6': !!originalDonation.receiverAccount,
        'col-lg-12': !originalDonation.receiverAccount
      }">
        <mat-card>
          <mat-card-title>Pickup Info</mat-card-title>
          <mat-card-content>
            <div class="row">
              <div *ngIf="originalDonation.donorAccount.organization.deliveryInstructions" class="col-sm-12">
                <div class="inline-label">Instructions:</div>
                <div class="d-inline-block">{{ originalDonation.donorAccount.organization.deliveryInstructions }}</div>
              </div>
              <div class="col-sm-6">
                <div class="inline-label">Pickup Window Start:</div>
                <div class="d-inline-block">{{ originalDonation.pickupWindowStart | date:'short' }}</div>
              </div>
              <div class="col-sm-6">
                <div class="inline-label">Pickup Window End:</div>
                <div class="d-inline-block">{{ originalDonation.pickupWindowEnd | date:'short' }}</div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
      <div *ngIf="originalDonation.receiverAccount" class="col-lg-6">
        <mat-card class="drop-off-information-container">
          <mat-card-title>Drop-Off Info</mat-card-title>
          <mat-card-content>
            <div class="row">
              <div *ngIf="originalDonation.receiverAccount.organization.deliveryInstructions" class="col-sm-12">
                <div class="inline-label">Instructions:</div>
                <div class="d-inline-block">{{ originalDonation.receiverAccount.organization.deliveryInstructions }}</div>
              </div>
              <!-- <div class="col-sm-6">
                <div class="inline-label">Window Start:</div>
                <div class="d-inline-block">{{ originalDonation.dropOffWindowStart | date:'short' }}</div>
              </div>
              <div class="col-sm-6">
                <div class="inline-label">Window End:</div>
                <div class="d-inline-block">{{ originalDonation.dropOffWindowEnd | date:'short' }}</div>
              </div> -->
            </div>
          </mat-card-content>
        </mat-card>
      </div>
      <div class="donor-info-container" [ngClass]="{
        'col-lg-6': !!originalDonation.receiverAccount,
        'col-lg-12': !originalDonation.receiverAccount
      }">
        <mat-card>
          <mat-card-header>
            <img mat-card-avatar src="/assets/{{ accountHelper.organizationFirstChar(originalDonation.donorAccount.organization) }}.svg" alt="Donor Icon">
            <mat-card-title>Donor</mat-card-title>
            <mat-card-subtitle class="organization-name">{{ originalDonation.donorAccount.organization.organizationName }}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <food-web-contact-info [contactInfo]="originalDonation.donorAccount.contactInfo"></food-web-contact-info>
          </mat-card-content>
          <mat-card-actions class="align-right">
            <div class="align-right">
              <a [routerLink]="['/account-details/', originalDonation.donorAccount.id]">
                <button mat-raised-button type="button" color="primary">View Account</button>
              </a>
            </div>
          </mat-card-actions>
        </mat-card>
      </div>
      <div *ngIf="originalDonation.receiverAccount" class="receiver-info-container col-lg-6">
        <mat-card>
          <mat-card-header>
            <img mat-card-avatar src="/assets/{{ accountHelper.organizationFirstChar(originalDonation.receiverAccount.organization) }}.svg" alt="Receiver Icon">
            <mat-card-title>Receiver</mat-card-title>
            <mat-card-subtitle class="organization-name">{{ originalDonation.receiverAccount.organization.organizationName }}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <food-web-contact-info [contactInfo]="originalDonation.receiverAccount.contactInfo"></food-web-contact-info>
          </mat-card-content>
          <mat-card-actions>
            <div class="align-right">
              <a [routerLink]="['/account-details/', originalDonation.receiverAccount.id]">
                <button mat-raised-button type="button" color="primary">View Account</button>
              </a>
            </div>
          </mat-card-actions>
        </mat-card>
      </div>
    </div>
  </ng-container>
</div>

<div *ngIf="donationNotFound" class="page-title block-header">
  <strong>Donation not found</strong>
</div>
